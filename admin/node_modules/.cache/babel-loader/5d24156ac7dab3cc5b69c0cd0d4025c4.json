{"ast":null,"code":"import { setTimerId, getTimerId, getDateAttribute } from './utils/dom';\nimport { formatDiff, diffSec, nextInterval } from './utils/date';\nimport { getLocale } from './register';\n// all realtime timer\nvar TIMER_POOL = {};\n/**\r\n * clear a timer from pool\r\n * @param tid\r\n */\nvar clear = function (tid) {\n  clearTimeout(tid);\n  delete TIMER_POOL[tid];\n};\n// run with timer(setTimeout)\nfunction run(node, date, localeFunc, opts) {\n  // clear the node's exist timer\n  clear(getTimerId(node));\n  var relativeDate = opts.relativeDate,\n    minInterval = opts.minInterval;\n  // get diff seconds\n  var diff = diffSec(date, relativeDate);\n  // render\n  node.innerText = formatDiff(diff, localeFunc);\n  var tid = setTimeout(function () {\n    run(node, date, localeFunc, opts);\n  }, Math.min(Math.max(nextInterval(diff), minInterval || 1) * 1000, 0x7fffffff));\n  // there is no need to save node in object. Just save the key\n  TIMER_POOL[tid] = 0;\n  setTimerId(node, tid);\n}\n/**\r\n * cancel a timer or all timers\r\n * @param node - node hosting the time string\r\n */\nexport function cancel(node) {\n  // cancel one\n  if (node) clear(getTimerId(node));\n  // cancel all\n  // @ts-ignore\n  else Object.keys(TIMER_POOL).forEach(clear);\n}\n/**\r\n * render a dom realtime\r\n * @param nodes\r\n * @param locale\r\n * @param opts\r\n */\nexport function render(nodes, locale, opts) {\n  // by .length\n  // @ts-ignore\n  var nodeList = nodes.length ? nodes : [nodes];\n  nodeList.forEach(function (node) {\n    run(node, getDateAttribute(node), getLocale(locale), opts || {});\n  });\n  return nodeList;\n}","map":{"version":3,"sources":["../src/realtime.ts"],"names":[],"mappings":"AAAA,SAAS,UAAU,EAAE,UAAU,EAAE,gBAAgB,QAAQ,aAAa;AACtE,SAAS,UAAU,EAAE,OAAO,EAAE,YAAY,QAAQ,cAAc;AAChE,SAAS,SAAS,QAAQ,YAAY;AAGtC;AACA,IAAM,UAAU,GAAc,CAAA,CAAE;AAEhC;;;AAGG;AACH,IAAM,KAAK,GAAG,SAAA,CAAC,GAAW,EAAA;EACxB,YAAY,CAAC,GAAG,CAAC;EACjB,OAAO,UAAU,CAAC,GAAG,CAAC;AACxB,CAAC;AAED;AACA,SAAS,GAAG,CAAC,IAAiB,EAAE,IAAY,EAAE,UAAsB,EAAE,IAAU,EAAA;EAC9E;EACA,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;EAEf,IAAA,YAAA,GAAA,IAAA,CAAA,YAAY;IAAE,WAAA,GAAA,IAAA,CAAA,WAAW;EAEjC;EACA,IAAM,IAAI,GAAG,OAAO,CAAC,IAAI,EAAE,YAAY,CAAC;EACxC;EACA,IAAI,CAAC,SAAS,GAAG,UAAU,CAAC,IAAI,EAAE,UAAU,CAAC;EAE7C,IAAM,GAAG,GAAI,UAAU,CAAC,YAAA;IACtB,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,CAAC;EACnC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,WAAW,IAAI,CAAC,CAAC,GAAG,IAAI,EAAE,UAAU,CAAC,CAAuB;EAErG;EACA,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC;EACnB,UAAU,CAAC,IAAI,EAAE,GAAG,CAAC;AACvB;AAEA;;;AAGG;AACH,OAAM,SAAU,MAAM,CAAC,IAAkB,EAAA;EACvC;EACA,IAAI,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;EACjC;EACA;EAAA,KACK,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC;AAC7C;AAEA;;;;;AAKG;AACH,OAAM,SAAU,MAAM,CAAC,KAA6C,EAAE,MAAe,EAAE,IAAW,EAAA;EAChG;EACA;EACA,IAAM,QAAQ,GAAkB,KAAK,CAAC,MAAM,GAAG,KAAK,GAAG,CAAC,KAAK,CAAC;EAE9D,QAAQ,CAAC,OAAO,CAAC,UAAC,IAAiB,EAAA;IACjC,GAAG,CAAC,IAAI,EAAE,gBAAgB,CAAC,IAAI,CAAC,EAAE,SAAS,CAAC,MAAM,CAAC,EAAE,IAAI,IAAI,CAAA,CAAE,CAAC;EAClE,CAAC,CAAC;EAEF,OAAO,QAAQ;AACjB","sourceRoot":"","sourcesContent":["import { setTimerId, getTimerId, getDateAttribute } from './utils/dom';\r\nimport { formatDiff, diffSec, nextInterval } from './utils/date';\r\nimport { getLocale } from './register';\r\n// all realtime timer\r\nvar TIMER_POOL = {};\r\n/**\r\n * clear a timer from pool\r\n * @param tid\r\n */\r\nvar clear = function (tid) {\r\n    clearTimeout(tid);\r\n    delete TIMER_POOL[tid];\r\n};\r\n// run with timer(setTimeout)\r\nfunction run(node, date, localeFunc, opts) {\r\n    // clear the node's exist timer\r\n    clear(getTimerId(node));\r\n    var relativeDate = opts.relativeDate, minInterval = opts.minInterval;\r\n    // get diff seconds\r\n    var diff = diffSec(date, relativeDate);\r\n    // render\r\n    node.innerText = formatDiff(diff, localeFunc);\r\n    var tid = setTimeout(function () {\r\n        run(node, date, localeFunc, opts);\r\n    }, Math.min(Math.max(nextInterval(diff), minInterval || 1) * 1000, 0x7fffffff));\r\n    // there is no need to save node in object. Just save the key\r\n    TIMER_POOL[tid] = 0;\r\n    setTimerId(node, tid);\r\n}\r\n/**\r\n * cancel a timer or all timers\r\n * @param node - node hosting the time string\r\n */\r\nexport function cancel(node) {\r\n    // cancel one\r\n    if (node)\r\n        clear(getTimerId(node));\r\n    // cancel all\r\n    // @ts-ignore\r\n    else\r\n        Object.keys(TIMER_POOL).forEach(clear);\r\n}\r\n/**\r\n * render a dom realtime\r\n * @param nodes\r\n * @param locale\r\n * @param opts\r\n */\r\nexport function render(nodes, locale, opts) {\r\n    // by .length\r\n    // @ts-ignore\r\n    var nodeList = nodes.length ? nodes : [nodes];\r\n    nodeList.forEach(function (node) {\r\n        run(node, getDateAttribute(node), getLocale(locale), opts || {});\r\n    });\r\n    return nodeList;\r\n}\r\n//# sourceMappingURL=realtime.js.map"]},"metadata":{},"sourceType":"module"}